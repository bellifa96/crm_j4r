<link href="https://cdn.jsdelivr.net/npm/select2/dist/css/select2.min.css" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/select2/dist/js/select2.min.js"></script>
<style>
	.flex-input-row {
    display: flex;
    align-items: center; /* Align items vertically */
}

.flex-input-container {
    display: flex;
    gap: 5px; /* Adjust as needed */
}

/* Adjust margins or paddings as needed */
.form-group {
    margin-bottom: 15px;
}

.label {
    margin-right: 10px; /* Adjust as needed */
}

</style>
<div class="container mt-5">
	<div class="col-md-11 m-auto page-block mt-4">
		<div class="societe">
			<div class="row form">
				<div class="col-md-4">
				
					<div class="form-group">
						<label for="NumAffaire" class="font-weight-bold">Chantier J4R</label>
						<select id="commande_chantier" name="chantier" class="form-control form-control-sm-2 societe-input">


							{% if transport is defined %}
								{% for trs in transporteurs %}
								{% endfor %}
								{% for ch in chantiers %}
								<option value="{{ ch.idchantier }}" {% if transport.getNumchantierdep() is defined and ch.idchantier == transport.getNumchantierdep().getIdChantier() %} selected {% endif %}>{{ ch.numchantier }}</option>
							    {% endfor %}

							{% else %}
								{% for ch in chantiers %}
								<option value="{{ ch.idchantier }}">{{ ch.numchantier }}</option>
							    {% endfor %}

							{% endif %}

						</select>


					</div>
					<div class="form-group">
						<label for="codeChantier" class="font-weight-bold">heure prévisionnel</label>
						<input type="time" id="heureprev" class="form-control form-control-sm-2 societe-input" name="heureprev"/>


					</div>

					
							<!-- Add similar blocks for other fields in the first column -->
				</div>
				<div class="col-md-4">
				
					
				<div class="form-group">
			           <label for="codeChantier" class="font-weight-bold">Indication de volume camion</label>
			             <select name="indication" id="indication" class="form-control form-control-sm-2 societe-input">
			              	
							{% if transport is not null %}
								<option value="0" {% if transport.getVolume() == "0" %} selected {% endif %}></option>
								<option value="1" {% if transport.getVolume() == "1" %} selected {% endif %}>Complet</option>
								<option value="2" {% if transport.getVolume() == "2" %} selected {% endif %}>Demi</option>
								<option value="3" {% if transport.getVolume() == "3" %} selected {% endif %}>Trois-quarts</option>
							{% else %}
					       	<option value="0"></option>
					        <option value="1">Complet</option>
					        <option value="2">Demi</option>
					          <option value="3">Trois-quarts</option>
							{% endif %}
			            </select>

		        </div>
					<div class="form-group">
						<label for="codeChantier" class="font-weight-bold">Type</label>
						<select name="sens" id="sens" class="form-control form-control-sm-2 societe-input">
					
						{% if transport is not null %}
						<option value="1" {% if transport.getTypeTransport() == 1 %} selected {% endif %}>Livraison</option>
						<option value="2" {% if transport.getTypeTransport() == 2 %} selected {% endif %}>Ramasse TY</option>
						<option value="3" {% if transport.getTypeTransport() == 3 %} selected {% endif %}>Ramasse TS</option>
					    <option value="4" {% if transport.getTypeTransport() == 4 %} selected {% endif %}>Rotation</option>
				        <option value="5" {% if transport.getTypeTransport() == 5 %} selected {% endif %}>Transfert</option>

				      	{% else %}
					     <option value="1">Livraison</option>
				         <option value="2">Ramasse TY</option>
				         <option value="3">Ramasse TS</option>
				         <option value="4">Rotation</option>
				         <option value="5">Transfert</option>
					   {% endif %}
						</select>

					</div>
					
					<div class="form-group" id="chantier_arrive" {% if transport.getTypeTransport() == 5  %} style="display:none;" {% endif %}>
				         <label for="NumAffaire" class="font-weight-bold">Chantier J4R Arrivé</label>
				            <select id="commande_chantier_arrive" name="chantier" class="form-control form-control-sm-2 societe-input">
				             	
							{% if transport is defined and transport.getNumchantierarrive() is not null  %}
						
							{% for ch in chantiers %}
							<option value="{{ ch.idchantier }}" {% if transport.getNumchantierarrive() is defined and ch.idchantier == transport.getNumchantierarrive().getIdChantier() %} selected {% endif %}>{{ ch.numchantier }}</option>
							{% endfor %}

						    {% else %}
							{% for ch in chantiers %}
							<option value="{{ ch.idchantier }}">{{ ch.numchantier }}</option>
							{% endfor %}

						     {% endif %}

				            </select>


					</div>
				

					


					<!-- Add similar blocks for other fields in the first column -->
				</div>

				<div class="col-md-4">
					<div class="form-group">
						<label for="codeChantier" class="font-weight-bold">Poids Transport</label>
						<input type="number" id="poids" name="poids" class="form-control form-control-sm-2 societe-input " {% if transport is not null %} value="{{ transport.getPoidsBon() }}" {% endif %} >

					</div>

					<div class="form-group">
						<label for="NumAffaire" class="font-weight-bold">Date transport</label>
						<div class="col-md-6 flex-input-row">
						<div class="flex-input-container">
					    <input type="date" id="date_transport" class="form-control form-control-sm-2 societe-input" {% if transport is not null %} value="{{ transport.getDateTransport()|date('Y-m-d') }}" {% endif %} name="date_transport"/>
					     <input type="time" id="heure_dep1_transport" class="form-control form-control-sm-2 societe-input" name="heure_dep1_transport" {% if transport is not null %} value="{{ transport.getHeuredepart()|date('H:i') }}" {% endif %}/>
				     </div></div>
					</div>
			
					
					<!-- Add similar blocks for other fields in the third column -->
					

				</div>
			</div>
			<div class="col-md-12">
							<div class="form-group">
                                    <label for="NumAffaire" class="font-weight-bold">
                                        Adresse Chantier
                                    </label>
                                    <input type="text" id="address_chantier" class="form-control form-control-sm-2 societe-input" {% if transport is not null %} value="{{ transport.getAdressechantier() }}" {% endif %} name="address_chantier" />
                                </div>
						</div>

		</div>

	
		{% if transport == null %}
    <div class="btn btn-light" id="ajouter_transport">Ajouter</div>
    <div class="col-md-4" id="affecter_transport" style="float:right;">
        <div id="affectation_btn" class="btn btn-success btn-block">
            <span class="mr-2">Affecter Transport</span>
            <i class="fas fa-check"></i>
        </div>
    </div>
      {% elseif transport.getIdtransporteur() == null or transport.getIdtransporteur() != null  %}
    <div class="col-md-4" id="affecter_transport" style="float:right;">
        <div id="affectation_btn" class="btn btn-success btn-block">
            <span class="mr-2">Modification Affectation </span>
            <i class="fas fa-check"></i>
        </div>
    </div>
       {% endif %}

	<br>
	</div>
	<div id="affectation_transport" style="display:none;">
	{% include "transports/affecter_new_transport.html.twig" %}

    </div>
</div></div><script>
    $("#affecter_transport").click(function(){
        // Your code to handle the click event goes here
		$("#affectation_transport").show();

    });

let idchantier = -1;
$(document).ready(function () {
$('#commande_chantier').select2({
theme: "classic", width: 'resolve' // This helps with styling and width issues
});
});
$('#commande_chantier').on('change', function() {
    var selectedOption = $(this).find('option:selected');
     idchantier = selectedOption.val();
    console.log("Selected idchantier:", idchantier);
});
$(document).ready(function () {
$("#fermer").click(function () {
$("#affectation_transport").hide(); // Cache l'élément avec l'ID 'affectation_transport'
});
$("#ajouter_transport").click(function () {});

$("#affectation_btn").click(function () {
$("#affectation_transport").show(); // afficher l'élément avec l'ID 'affectation_transport'
});
// event listner sur select transporteur

$('#transporteur').change(function () { // Récupère l'ID sélectionné
var selectedId = $(this).val();

// Récupère les données des transporteurs depuis localStorage
var transporteurs = JSON.parse(localStorage.getItem('transporteurs')) || [];

// Recherche si l'ID sélectionné est dans les données stockées
var transporteurTrouve = transporteurs.find(function (trs) {
return trs.idtransporteur.toString() === selectedId;
});

// Comparaison et action en fonction de la correspondance
if (transporteurTrouve) {
// Vous pouvez ici accéder à d'autres propriétés comme transporteurTrouve.tauxprefere

// Exemple d'action: mettre à jour un autre champ avec le taux préféré
$('#tauxPrefere').val(transporteurTrouve.tauxprefere);
$('#tauxSelect').val(transporteurTrouve.tauxprefere);
var tauxPrefere = transporteurTrouve.tauxprefere;

switch (tauxPrefere) {
case "1":
// Logique spécifique au cas 1
$('#tarification').val(transporteurTrouve.tauxhoraire);
break;
case "2":
// Logique spécifique au cas 2
$('#tarification').val(transporteurTrouve.tauxtour);
break;
case "3":
// Logique spécifique au cas 3
$('#tarification').val(transporteurTrouve.tauxjour);
break;
case "4":
// Logique spécifique au cas 4
$('#tarification').val(transporteurTrouve.tauxdemijour);
break;
case "5":
// Logique spécifique au cas 5
$('#tarification').val(transporteurTrouve.tauxtonne);
break;
default:
console.log('Aucun taux préféré spécifié ou valeur non reconnue.');

}


} else {
console.log("Aucun transporteur correspondant trouvé dans localStorage.");
}
});
// fin evennt select

// button affection



});
// o, stocker les donnes sur localStorage les donnes des tranporteurs
$(document).ready(function () { // Vérifie si les données ne sont pas déjà stockées
if (!localStorage.getItem('transporteurs')) {
$.getJSON('/commandes/transporteurs', function (data) {
localStorage.setItem('transporteurs', JSON.stringify(data));
});
}

// Exemple de récupération et utilisation des données
const transporteurs = JSON.parse(localStorage.getItem('transporteurs'));
console.log(transporteurs); // Utilisez les données comme nécessaire
});


$(document).ready(function () {
		$('#commande_chantier').select2({
			theme: "classic",
			width: 'resolve' // This helps with styling and width issues
}).on('change', function() {
			// Your onchange action goes herepCha
var selectedChantierId = $(this).val(); // Get the ID of the selected Chantier
$.ajax({
type: 'GET',
url: '/chantier/get-chantier-adresse',
data: {
chantier: selectedChantierId
},
success: function (data) {
	
	$('#address_chantier').val(data[0].adresse)
},
error: function (error) {
console.error('Error:', error);
}
});
		});

$('#commande_chantier_arrive').select2({
theme: "classic", width: 'resolve' // This helps with styling and width issues
});


$('#commande_chantier_arrive').select2({
theme: "classic", width: 'resolve' // This helps with styling and width issues
});
		


		});
		$(document).ready(function () {
			// gérer le sens 5 c'est transfert donc notre spécification c'est que il faut un code chantier arrive
			var selectedValue = $("#sens").val();
				
			if(selectedValue ==  5){
				$('#chantier_arrive').show();
			}else{
				$('#chantier_arrive').hide();
		
			}
			
			$("#sens").change(function() {
				// Récupérer la valeur sélectionnée
				var selectedValue = $(this).val();
				
				if(selectedValue ==  5){
					$('#chantier_arrive').show();
				}else{
					$('#chantier_arrive').hide();
			
				}
			});
			
			$('#commande_chantier').select2({
			theme: "classic", width: 'resolve' // This helps with styling and width issues
			});
			});
</script>
