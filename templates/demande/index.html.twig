{% extends 'base.html.twig' %}

{% block title %}Demande index{% endblock %}

{% block body %}


    <style>
        table {
            overflow: auto;
        }
    </style>

    <button class="btn btn-info-2 mb-4" id="vue" value="globale">Vue Commerciale</button>
    <div id="globale">

        <table class="table datatable text-center">
            <thead>
            <tr class="tr-head text-center">
                <th>N°Demande</th>
                <th>Nom Chantier</th>
                <th>Type d'Échafaudage</th>
                <th>Client</th>
                <th>Maitre d'ouvrage</th>
                <th>Intermediaire</th>
                <th>Date</th>
                <th>CP</th>
                <th>Ville</th>
                <th>Statut</th>
                <th>Par</th>
            </tr>
            </thead>
            <tbody>
            {% for demande in demandes %}
                <tr>
                    <td><a href="{{ path('app_demande_show', {'id': demande.id}) }}">{{ demande.id }}</a></td>
                    <td><a href="{{ path('app_demande_show', {'id': demande.id}) }}">{{ demande.nomChantier }}</a></td>
                    <td>{{ demande.typeEchafaudage }}</td>
                    <td>
                        {% if demande.client is not empty %}
                            <a href="{{ path('app_interlocuteur_interlocuteur_show',{'id':demande.client.id}) }}"> {{ demande.client.societe ? demande.client.societe.raisonSociale : demande.client.personne.nom~" "~demande.client.personne.prenom }}</a>
                        {% endif %}
                    </td>
                    <td>{% if demande.intermediaire is not empty %}<a
                            href="{{ path('app_interlocuteur_interlocuteur_show',{'id':demande.intermediaire.id}) }}"> {{ demande.intermediaire.societe ? demande.intermediaire.societe.raisonSociale : demande.intermediaire.personne.nom~" "~demande.intermediaire.personne.prenom }} </a>
                        {% endif %}
                    </td>
                    <td>{% if demande.maitreDOuvrage is not empty %}<a
                            href="{{ path('app_interlocuteur_interlocuteur_show',{'id':demande.maitreDOuvrage.id}) }}"> {{ demande.maitreDOuvrage.societe ? demande.maitreDOuvrage.societe.raisonSociale : demande.maitreDOuvrage.personne.nom~" "~demande.maitreDOuvrage.personne.prenom }} </a>
                        {% endif %}
                    </td>
                    <td>{{ demande.date }}</td>
                    <td>{{ demande.codePostal }}</td>
                    <td>{{ demande.ville }}</td>
                    <td>{{ demande.statut }}</td>
                    <td>{{ demande.createur.lastname~" "~demande.createur.firstname }}</td>


                </tr>
            {% else %}
                <tr>
                    <td colspan="10">no records found</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>

    </div>

    <div id="commerciale" style="display: none;">


        <table class="table datatable text-center">
            <thead>
            <tr class="tr-head text-center">
                <th>Statut</th>
                <th>A relancer Le</th>
                <th>N°Demande</th>
                <th>Client</th>
                <th>Nom chantier</th>
                <th>CP</th>
                <th>Ville</th>
                <th>Interlocuteur</th>
                <th>Tel</th>
                <th>Date du Devis</th>
                <th>Commentaire</th>

            </tr>
            </thead>
            <tbody>
            {% for demande in demandes %}
                <tr class="text-center">
                    <td>
                        <a href="{{ path('app_demande_show', {'id': demande.id}) }}">
                            <div class="badge "
                                 style="font-size:1em;background:{{ demande.statutCommercial is not empty ? demande.statutCommercial.couleurBG : '' }};color: {{ demande.statutCommercial is not empty ? demande.statutCommercial.couleur : '' }};">{{ demande.statutCommercial }}</div>
                        </a>
                    </td>
                    <td></td>
                    <td><a href="{{ path('app_demande_show', {'id': demande.id}) }}">{{ demande.reference }}</a></td>
                    <td>
                        {% if demande.client is not empty %}
                            <a href="{{ path('app_interlocuteur_interlocuteur_show',{'id':demande.client.id}) }}"> {{ demande.client.societe ? demande.client.societe.raisonSociale : demande.client.personne.nom~" "~demande.client.personne.prenom }}</a>
                        {% endif %}
                    </td>
                    <td><a href="{{ path('app_demande_show', {'id': demande.id}) }}">{{ demande.nomChantier }}</a></td>
                    <td>{{ demande.codePostal }}</td>
                    <td>{{ demande.ville }}</td>
                    <td>
                        {% if demande.contactPrincipalClient is not empty %}
                            <a href="{{ path('app_contact_contact_show',{'id':demande.contactPrincipalClient.id}) }}">
                                {{ demande.contactPrincipalClient.nom~" "~demande.contactPrincipalClient.prenom }}
                            </a>
                        {% endif %}
                    </td>

                    <td>
                        {% if demande.contactPrincipalClient is not empty %}
                            {{ demande.contactPrincipalClient.telephoneMobile is not empty ? demande.contactPrincipalClient.telephoneMobile : demande.contactPrincipalClient.telephone }}
                        {% endif %}
                    </td>
                    <td></td>

                    <td>
                        {% if demande.conversationClient is not empty %}
                            <a href="{{ path('app_demande_show', {'id': demande.id,'menu':'commentaires-tab'}) }}">
                                {{ demande.conversationClient.messages[demande.conversationClient.messages|length - 1].message }}
                            </a>
                        {% endif %}
                    </td>


                </tr>
            {% else %}
                <tr>
                    <td colspan="13">no records found</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>

    </div>

    <script>
        $('#vue').click(function () {
            console.log($(this).val())
            if ($(this).val() === "globale") {
                $('#commerciale').slideDown();
                $('#globale').slideUp();
                $(this).val('commerciale');
                $(this).text('Vue globale')
            } else if ($(this).val() === "commerciale") {
                $('#commerciale').slideUp();
                $('#globale').slideDown();
                $(this).val('globale');
                $(this).text('Vue commerciale')

            }
        })
    </script>
{% endblock %}
