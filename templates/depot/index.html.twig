{% extends 'base.html.twig' %}

{% block title %}
	Articles
{% endblock %}

{% block body %}
	<style>
		.container {
			display: flex;
			align-items: center;
			justify-content: space-between;
			width: 100%; /* Set your desired width */
			padding: 10px;
		}

		.left {
			flex: 1; /* Takes up available space on the left */

		}

		.right {
			flex: 2; /* Takes up available space on the right */
			margin-left: 20px; /* Add margin for spacing between left and right */
			display: flex;
			justify-content: flex-end;

		}

		select {
			width: 20%;
			padding: 5px;
		}
		.title_article {
			font-family: 'Poppins', sans-serif;
			color: black;
			font-size: 30px;
			margin-left: 10%;
		}
		.basic {
			width: 200px;
			height: 35px;
			background: #f5f5f5;
			font-family: 'Poppins', sans-serif;

		}
		.right select {
			margin-right: 10px;
		}
	</style>

	<div class="example-wrapper">
		<div class="container">

			<div class="right">
				<select class="basic" id="agenceSelect">
					{% for agence in agences %}
						<option value="{{ agence.idagence }}" {% if loop.first %} selected {% endif %}>
							{{ agence.nomagence }}
						</option>
					{% endfor %}
				</select>
				<button class="basic" id="openModalButton">
					<a href="{{ path('app_depot_add') }}" class="sidebar-link  ">
						<span>
							Nouveau
						</span>
					</a>
				</button>

			</div>
		</div>
	</div>

	<div class="page-block col-lg-12">
		<table class="table text-center datatable" id="depotTable" style="color: #0E4377;">
			<thead>
				<tr class="tr-head">
					<th>Code Dépot</th>
					<th>Désignation</th>
					<th>Adresse Agence</th>
					<th>Code Postale</th>
					<th>Ville Agence</th>
					<th>Télephone</th>
					<th>Portable</th>

					<th>Action</th>
				</tr>
			</thead>
			<tbody>

				{% for depot in depots %}
					<tr>
						<td>{{ depot.codedepot }}</td>
						<td>{{ depot.nomdepot }}</td>
						<td>{{ depot.adressedepot }}</td>
						<td>{{ depot.cpdepot }}</td>
						<td>{{ depot.villedepot }}</td>
						<td>{{ depot.contacttel }}</td>
						<td>{{ depot.contactportable }}</td>

						<td>
							<a href="{{ path('app_depot_edit', {'id': depot.iddepot }) }}" class="btn btn-warning" style="font-size: 10px;">
								Modifier
							</a>
						</td>

					</tr>
				{% endfor %}

			</tbody>
		</tbody>
	</table>
	<script>
		function redirect_to_page_edit_article(iddepot) {
window.location.href = '/edit-depot/' + iddepot;
}
function handleAgenceSelection() {
var selectedAgence = document.getElementById("agenceSelect").value;

if ($.fn.DataTable.isDataTable('#depotTable')) {
$('#depotTable').DataTable().destroy();
}

depotTable = $('#depotTable').DataTable({paging: true, order: []});

$.ajax({
type: 'GET',
url: '/get-depot',
data: {
selectedAgence: selectedAgence
},
success: function (data) {
depotTable.clear().draw();

// Populate the table with the new data
for (var i = 0; i < data.length; i++) {
var depot = data[i];
var newRow = [
'<td>' + depot.codedepot  + '</td>',
'<td>' + depot.nomdepot + '</td>',
'<td>' + depot.adressedepot + '</td>',
'<td>' + depot.cpdepot + '</td>',
'<td>' + depot.villedepot + '</td>',
'<td>' + depot.contacttel + '</td>',
'<td>' + depot.contactportable + '</td>',
'<button class="btn btn-warning" onclick="redirect_to_page_edit_article(' + depot.iddepot + ')"style="font-size: 10px;">Modifier</button>'
];
depotTable.row.add(newRow);
}

depotTable.draw();
},
error: function (error) {
console.error('Error:', error);
}
});
}
$(document).ready(function () {
$('#agenceSelect').on('change', function () { // Call the function to handle depot selection
handleAgenceSelection();
});
});
	</script>
</div>{% endblock %}
