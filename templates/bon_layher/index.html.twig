{% extends 'base.html.twig' %}

{% block title %}
	Commandes
{% endblock %}


{% block body %}
	<style>
		.form {
			margin-left: 15%;
			width: 70%;
		}
	</style>
	<div class="row form">
		<div class="col-md-4">
			<div class="form-group">
				<label for="NumAffaire" class="font-weight-bold">Num Affaire</label>
				<select id="NumAffaire" name="NumAffaire" class="form-select" disabled>
					{% for affaire in affaires %}
						<option value="{{affaire.id}}" {% if affaire.numaffaire == '1000X5B' %} selected {% endif %}>{{affaire.numaffaire}}</option>
					{% endfor %}
				</select>
			</div>
			<div class="form-group">
				<label for="NomClient" class="font-weight-bold">Nom</label>
				<input type="text" id="NomClient" name="NomClient" class="form-control" value="J4R Echafaudages/CH. GROUPE {{ 'now'|date('Y') }} ">
			</div>
			<!-- Add similar blocks for other fields in the first column -->
		</div>
		<div class="col-md-4">
			<div class="form-group">
				<label for="DateDu" class="font-weight-bold">DU</label>
				<input type="date" id="DateDu" name="DateDu" class="form-control" value="">
			</div>

			<div class="form-group">
				<label for="DetailChantier" class="font-weight-bold">Detail</label>
				<input type="text" id="DetailChantier" name="DetailChantier" class="form-control" value="CHANTIERS GROUPE {{ 'now'|date('Y') }}">
			</div>
			<!-- Add similar blocks for other fields in the second column -->
		</div>
		<div class="col-md-4">
			<div class="form-group">
				<label for="DateAu" class="font-weight-bold">Au</label>
				<input type="date" id="DateAu" name="DateAu" class="form-control" value="">
			</div>
			<div class="form-group">
				<label for="NumBon" class="font-weight-bold">Num Bon</label>
				<select id="bonlayher" name="bonlayher" class="form-select">
					<option value=""></option>
					<!-- Add options dynamically if needed -->
				</select>
			</div>
			<!-- Add similar blocks for other fields in the third column -->
		</div>
	</div>
	<div
		class="page-block form col-lg-12">
		{# do something #}

		<table class="table text-center datatable" id="ArticleBonTable" style="color: #0E4377;">
			<thead>
				<tr class="tr-head">
					<th>Code Article</th>
					<th>Designation</th>
					<th>Qte</th>
					<th>Poids</th>

				</tr>
			</thead>
			<tbody></tbody>
		</tbody>
	</table>
</div>

<div class="row form">
    <div class="col-md-4">
        <div class="form-group">
            <label for="Consignes" class="font-weight-bold">Consignes</label>
            <input type="text" id="Consignes" name="Consignes" class="form-control" value="Champs Vide">
        </div>
        <div class="form-group">
            <label for="HeurePense1" class="font-weight-bold">Heure Pensé 1</label>
            <input type="text" id="HeurePense1" name="HeurePense1" class="form-control" value="09:30">
        </div>
        <div class="form-group">
            <label for="HeurePense2" class="font-weight-bold">Heure Pensé 2</label>
            <input type="text" id="HeurePense2" name="HeurePense2" class="form-control" value="09:30">
        </div>
        <!-- Add similar blocks for other fields in the first column -->
    </div>
    <div class="col-md-4">
        <div class="form-group">
            <label for="NTicket" class="font-weight-bold">N ticket</label>
            <input type="text" id="NTicket" name="NTicket" class="form-control" value="27478">
        </div>
        <div class="form-group">
            <label for="PoidsPense1" class="font-weight-bold">Poids Pensé 1</label>
            <input type="text" id="PoidsPense1" name="PoidsPense1" class="form-control" value="11600">
        </div>
        <div class="form-group">
            <label for="PoidsPense2" class="font-weight-bold">Poids Pensé 2</label>
            <input type="text" id="PoidsPense2" name="PoidsPense2" class="form-control" value="11600">
        </div>
        <!-- Add similar blocks for other fields in the second column -->
    </div>
    <div class="col-md-4">
        <div class="form-group">
            <label for="Arrive" class="font-weight-bold">Arrivé</label>
            <input type="text" id="Arrive" name="Arrive" class="form-control" value="09:29">
        </div>
        <div class="form-group">
            <label for="NBascule1" class="font-weight-bold">N bascule 1</label>
            <input type="text" id="NBascule1" name="NBascule1" class="form-control" value="47 963">
        </div>
        <div class="form-group">
            <label for="NBascule2" class="font-weight-bold">N bascule 2</label>
            <input type="text" id="NBascule2" name="NBascule2" class="form-control" value="47 963">
        </div>
        <!-- Add similar blocks for other fields in the third column -->
    </div>
</div>

<script>
	document.getElementById('DateDu').addEventListener('change', function () {
var minDateDu = this.value;
document.getElementById('DateAu').min = minDateDu;
getBonLayher();

});
document.getElementById('DateAu').addEventListener('change', function () {
var minDateDu = this.value;
document.getElementById('DateDu').max = minDateDu;
getBonLayher();
});
function getCurrentDate() {
var today = new Date();
var dd = String(today.getDate()).padStart(2, '0');
var mm = String(today.getMonth() + 1).padStart(2, '0'); // January is 0!
var yyyy = today.getFullYear();
return yyyy + '-' + mm + '-' + dd;
}

// Set the initial value of DateDu and DateAu to the current date
document.getElementById('DateDu').value = getCurrentDate();
document.getElementById('DateAu').value = getCurrentDate();

function getBonLayher() {
let DateDu = document.getElementById('DateDu').value;
let DateAu = document.getElementById('DateAu').value;
$.ajax({
type: "GET",
url: "/get-bon-layher",
data: {
datedu: DateDu,
dateau: DateAu
},
success: function (data) {

var select = $('#bonlayher');
select.empty();
console.log(data);


$.each(data, function (index, bon) {
select.append('<option   value="' + bon.numbon + '">' + bon.numbon + "-" + bon.typebon + "-" + bon.datemvt + '</option>');
});
},
error: function (error) {
console.log(error);
}
});
}


$(document).ready(function () { // Attach the onchange event handler to the 'bonlayher' select element
$('#bonlayher').on('change', function () { // Retrieve the selected value
var selectedValue = $(this).val();

$.ajax({
type: "GET",
url: "/get-article-bon",
data: {
numBonlayher: selectedValue
},
success: function (data) {
var ArticleBonTable;
if ($.fn.DataTable.isDataTable('#ArticleBonTable')) {
$('#ArticleBonTable').DataTable().destroy();
}

ArticleBonTable = $('#ArticleBonTable').DataTable({paging: true});
ArticleBonTable.clear().draw();
console.log(data);
// Populate the table with the new data
for (var i = 0; i < data.length; i++) {
var commande = data[i];
var newRow = [commande.codearticle, commande.designation, commande.qte, commande.poids,];
ArticleBonTable.row.add(newRow);
}

ArticleBonTable.draw();
},
error: function (error) {
console.log(error);
}
});

});
});
</script>{% endblock %}
